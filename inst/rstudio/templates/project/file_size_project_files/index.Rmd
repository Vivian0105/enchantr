--- 
title: "Immcantation - enchantR"
subtitle: "File size tracker"
author: ""
date: "Updated: `r date()`"
knit: "bookdown::render_book"
site: bookdown::bookdown_site
documentclass: book
bibliography: "references.bib"
biblio-style: apalike
link-citations: yes
description: "enchantr file size tracker report"
output: enchantr::immcantation
params:
   input: 
      label: "`input`: Path a file of files, with paths to the log files."
      input: file
      value: "example-input.txt"
   output: 'tmp_input'
   outdir:
      label: '`outdir`: Output directory'
      input: text
      value: !r file.path(getwd(),'enchantr')
   date: 
      label: '`date`: Run date'
      input: date
      value: !r format(Sys.time(), "%Y-%m-%d")
   logo:
      label: "`logo`: Path to report logo"
      input: file
      value: !r file.path("assets", "logo.png")
   logolink:
      label: "`logolink`: URL to be added to the logo"
      input: text
      value: "immcantation.org"
   echo: 
      label: '`echo`: Show code in the report.'
      input: checkbox
      value: FALSE
   cache:
      label: '`cache`: Use cached results'
      input: checkbox
      value: FALSE
editor_options: 
  chunk_output_type: inline
---

```{r global-options, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(fig.width=7, fig.height=4, fig.path = "figures/",
                      echo=params$echo,cache=params$cache,
                      warning=FALSE, message=FALSE,
                      out_dir=params$outdir,
                      eval.opts = c('eval', 'echo', 'fig.height', 'fig.width'))
library(enchantr)
file.copy(params$logo, 
          file.path(params$outdir,"assets", paste0("logo", gsub(".+(\\..+$)","\\1",params$logo))),
          recursive = T, overwrite=T)
```

# Input parameters

```{r input-parameters}
params
if (!dir.exists(params$outdir)) {
   dir.create(params$outdir, recursive = T)
}
save(params, file=file.path(params$outdir,"params.RData"))
```

```{r}
log_files <- read.delim(params[['input']], header=F)[[1]]
log_files
```

# File processing 

```{r, results="asis", echo=FALSE}
plot_list <- plotConsoleLogs(log_files)
for (i in 1:length(plot_list)) {
   plot_data <- plot_list[[i]]$data
   input_filename <- plot_data[['name']][which(plot_data[[".ggraph.index"]] == 1)]
   cat(paste0("## ",input_filename,"\n\n"))
   print(plot_list[[i]])
   cat("\n\n")
}
```

```{r, child=c('versions.Rmd')}
```

