image: immcantation/test:devel
pipelines:
  default:
    - step:
        name: Test
        script:
          - sed -i '/test/ d' .Rbuildignore
          - Rscript tests/setup/install_dep.R
          - R CMD build .
          - R CMD check *.tar.gz --as-cran --run-donttest --timings
    - step:
        name: Update immcantation/suite:devel
        script:
          - curl -H "Content-Type:application/json" --data '{"docker_tag":"devel"}' -X POST https://hub.docker.com/api/build/v1/source/${DOCKERHUB_REPO}/trigger/${DOCKERHUB_TRIGGER}/call/
    - step:
        name: Test nf-core/airrflow
        script:
          - sudo dnf install java -y
          - wget -qO- https://get.nextflow.io | bash && chmod +x nextflow && mv nextflow /usr/local/bin/nextflow
          - nextflow run nf-core/airrflow -r dev -profile test_assembled_immcantation_devel_hs,docker --outdir ./results
